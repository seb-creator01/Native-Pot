<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native Pot | Authentic Delicacies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfaf7; }
        .food-card:hover { transform: translateY(-10px); transition: 0.3s; }
        /* Added for Cart animation */
        .cart-bounce { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        #admin-modal, #order-modal { background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
        
        /* Force buttons to be clickable even if layers overlap */
        button, footer, span { cursor: pointer !important; pointer-events: auto !important; position: relative; z-index: 10; }
    </style>
</head>
<body class="pb-32">

    <header class="p-6 bg-white shadow-sm sticky top-0 z-50">
        <nav class="max-w-5xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-orange-700 tracking-tighter">NATIVE POT</h1>
            <div id="cart-counter" class="bg-orange-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold shadow-lg">0</div>
        </nav>
    </header>

    <section class="p-8 text-center animate__animated animate__fadeIn">
        <h2 class="text-4xl font-extrabold text-gray-900 leading-tight">Authentic taste, <br><span class="text-orange-600">delivered to your door.</span></h2>
        <p class="mt-4 text-gray-600">Experience the finest native delicacies made with love and tradition.</p>
    </section>

    <main id="menu-container" class="max-w-5xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <div class="food-card bg-white rounded-3xl overflow-hidden shadow-lg border border-orange-50 animate__animated animate__fadeInUp">
            <div class="h-48 bg-orange-200 bg-[url('https://images.unsplash.com/photo-1574484284002-952d92456975?auto=format&fit=crop&w=800&q=80')] bg-cover bg-center"></div>
            <div class="p-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Special Jollof</h3>
                    <span class="text-orange-700 font-bold">‚Ç¶4,500</span>
                </div>
                <p class="text-gray-500 text-sm mt-2">Smokey party Jollof served with fried plantain and choice of protein.</p>
                <button data-action="add" data-name="Special Jollof" data-price="4500" class="mt-6 w-full bg-orange-600 text-white py-3 rounded-2xl font-bold shadow-lg shadow-orange-200 active:scale-95 transition">Add to Pot</button>
            </div>
        </div>

        <div class="food-card bg-white rounded-3xl overflow-hidden shadow-lg border border-orange-50 animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
            <div class="h-48 bg-orange-200 bg-[url('https://images.unsplash.com/photo-1610614819513-58e34989848b?auto=format&fit=crop&w=800&q=80')] bg-cover bg-center"></div>
            <div class="p-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">Egusi & Swallow</h3>
                    <span class="text-orange-700 font-bold">‚Ç¶5,000</span>
                </div>
                <p class="text-gray-500 text-sm mt-2">Rich Egusi soup with assorted meats, served with fluffy pounded yam.</p>
                <button data-action="add" data-name="Egusi & Swallow" data-price="5000" class="mt-6 w-full bg-orange-600 text-white py-3 rounded-2xl font-bold shadow-lg shadow-orange-200 active:scale-95 transition">Add to Pot</button>
            </div>
        </div>

    </main>

    <div id="checkout-bar" class="fixed bottom-8 left-4 right-4 max-w-md mx-auto bg-black rounded-3xl p-5 shadow-2xl flex justify-between items-center translate-y-40 transition-transform duration-500 z-[100]">
        <div>
            <button id="clear-pot-btn" class="text-gray-400 text-[10px] uppercase font-bold tracking-widest mb-1 underline block">Clear Pot</button>
            <p id="total-price" class="text-white text-xl font-bold">‚Ç¶0</p>
        </div>
        <button id="send-order-btn" class="bg-orange-600 text-white px-8 py-3 rounded-xl font-extrabold active:scale-95 transition">Send Order</button>
    </div>

    <div id="admin-modal" class="fixed inset-0 z-[300] hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 animate__animated animate__zoomIn my-auto">
            <h3 class="text-xl font-bold mb-4">Chef Management</h3>
            
            <div class="mb-6 border-b pb-6 text-left">
                <p class="text-sm font-bold text-gray-400 mb-2 uppercase">Add New Dish</p>
                <input type="text" id="food-name" placeholder="Dish Name (e.g. Abacha)" class="w-full p-4 mb-3 bg-gray-100 rounded-2xl outline-none">
                <input type="number" id="food-price" placeholder="Price (‚Ç¶)" class="w-full p-4 mb-3 bg-gray-100 rounded-2xl outline-none">
                <input type="file" id="photo-file" accept="image/*" class="mb-4 text-sm w-full">
                <button id="save-btn" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-bold">Save to Site</button>
            </div>

            <div id="delete-list" class="max-h-40 overflow-y-auto mb-4 text-left">
                </div>
            
            <button id="close-admin-btn" class="w-full py-2 text-gray-400 font-bold text-center">Close Panel</button>
        </div>
    </div>

    <footer id="admin-trigger" class="text-center py-12 text-gray-400 text-sm cursor-pointer relative z-[200]">
        <p>&copy; 2026 Native Pot. All rights reserved. ‚Ä¢ <span class="underline text-orange-600 font-bold">Admin Access</span></p>
    </footer>

    <script>
        // --- SECURE CONNECTIONS ---
        const SUPABASE_URL = "https://rsyssgwehiosunegiqpk.supabase.co";
        const SUPABASE_KEY = "sb_publishable_b3sp-SMXTG7_cwIeY--t8g_4X-CjYb0";
        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/ddm87a9p2/image/upload";
        const CLOUDINARY_PRESET = "Native Pot";
        const phoneNumber = "2349032797037"; 

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let pot = [];

        // --- THE FIX: GLOBAL EVENT LISTENER ---
        document.addEventListener('click', function(e) {
            // Admin Open
            if (e.target.closest('#admin-trigger')) {
                document.getElementById('admin-modal').classList.remove('hidden');
            }
            // Admin Close
            if (e.target.id === 'close-admin-btn') {
                document.getElementById('admin-modal').classList.add('hidden');
            }
            // Add to Pot (Dynamic and Static)
            const addBtn = e.target.closest('button[data-action="add"]') || (e.target.tagName === 'BUTTON' && e.target.innerText.includes('Add to Pot'));
            if (addBtn) {
                // If it's a dynamic button from Supabase, we look at the data attributes we added in loadMenu
                const name = addBtn.getAttribute('data-name') || addBtn.parentElement.querySelector('h3').innerText;
                const price = addBtn.getAttribute('data-price') || addBtn.parentElement.querySelector('.text-orange-700').innerText.replace('‚Ç¶', '').replace(',', '');
                addToPot(name, parseInt(price));
            }
            // Clear Pot
            if (e.target.id === 'clear-pot-btn') {
                if(confirm("Do you want to empty your pot?")) {
                    pot = [];
                    updateUI();
                }
            }
            // Send Order
            if (e.target.id === 'send-order-btn') {
                sendOrder();
            }
        });

        // Load Menu from Supabase
        async function loadMenu() {
            try {
                const { data, error } = await supabase.from('menu').select('*').order('created_at', { ascending: false });
                if (error) throw error;

                const container = document.getElementById('menu-container');
                const deleteList = document.getElementById('delete-list');
                
                if (data && data.length > 0) {
                    container.innerHTML = ''; 
                    data.forEach(item => {
                        container.innerHTML += `
                            <div class="food-card bg-white rounded-3xl overflow-hidden shadow-lg border border-orange-50 animate__animated animate__fadeInUp">
                                <div class="h-48 bg-cover bg-center" style="background-image: url('${item.image}')"></div>
                                <div class="p-6">
                                    <div class="flex justify-between items-center">
                                        <h3 class="text-xl font-bold text-gray-800">${item.name}</h3>
                                        <span class="text-orange-700 font-bold">‚Ç¶${Number(item.price).toLocaleString()}</span>
                                    </div>
                                    <button data-action="add" data-name="${item.name}" data-price="${item.price}" class="mt-6 w-full bg-orange-600 text-white py-3 rounded-2xl font-bold shadow-lg shadow-orange-200 active:scale-95 transition">Add to Pot</button>
                                </div>
                            </div>
                        `;
                    });

                    deleteList.innerHTML = `<p class="text-xs font-bold text-gray-400 mb-2 uppercase">Tap to Delete:</p>` + 
                        data.map(item => `
                        <div data-delete-id="${item.id}" class="flex justify-between items-center p-2 mb-2 bg-red-50 text-red-600 rounded-lg text-sm cursor-pointer border border-red-100">
                            <span>${item.name}</span>
                            <span class="font-bold">üóëÔ∏è</span>
                        </div>
                    `).join('');
                }
            } catch (err) {
                console.log("Database load skipped or empty.");
            }
        }

        // Handle Dynamic Deletes
        document.getElementById('delete-list').addEventListener('click', function(e) {
            const deleteDiv = e.target.closest('[data-delete-id]');
            if (deleteDiv) {
                const id = deleteDiv.getAttribute('data-delete-id');
                deleteItem(id);
            }
        });

        async function uploadAndSave() {
            const fileInput = document.getElementById('photo-file');
            const file = fileInput.files[0];
            const name = document.getElementById('food-name').value;
            const price = document.getElementById('food-price').value;
            const btn = document.getElementById('save-btn');

            if(!file || !name || !price) return alert("Please enter name, price, and select a photo!");
            btn.innerText = "Processing...";
            btn.disabled = true;

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_PRESET);
            
            try {
                const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: formData });
                const imgData = await res.json();
                if (imgData.error) throw new Error(imgData.error.message);

                const { error } = await supabase.from('menu').insert([{ name, price, image: imgData.secure_url }]);
                if (error) throw error;
                location.reload();
            } catch (err) {
                alert("Error: " + err.message);
                btn.innerText = "Save to Site";
                btn.disabled = false;
            }
        }

        document.getElementById('save-btn').onclick = uploadAndSave;

        async function deleteItem(id) {
            if(confirm("Remove this dish from the menu?")) {
                const { error } = await supabase.from('menu').delete().eq('id', id);
                if (error) alert("Delete failed: " + error.message);
                else location.reload();
            }
        }

        function addToPot(name, price) {
            pot.push({name, price});
            updateUI();
            const counter = document.getElementById('cart-counter');
            counter.classList.add('cart-bounce');
            setTimeout(() => counter.classList.remove('cart-bounce'), 500);
        }

        function updateUI() {
            const bar = document.getElementById('checkout-bar');
            const totalDisplay = document.getElementById('total-price');
            const counter = document.getElementById('cart-counter');
            let total = pot.reduce((sum, item) => sum + item.price, 0);
            counter.innerText = pot.length;
            totalDisplay.innerText = `‚Ç¶${total.toLocaleString()}`;
            if(pot.length > 0) bar.classList.remove('translate-y-40');
            else bar.classList.add('translate-y-40');
        }

        function sendOrder() {
            if (pot.length === 0) return;
            let itemsList = pot.map(item => `- ${item.name} (‚Ç¶${item.price.toLocaleString()})`).join('\n');
            let total = pot.reduce((sum, item) => sum + item.price, 0);
            let message = `*NEW ORDER FROM NATIVE POT*\n\nItems:\n${itemsList}\n\n*Total: ‚Ç¶${total.toLocaleString()}*\n\nPlease confirm my order!`;
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        loadMenu();
    </script>
</body>
</html>
