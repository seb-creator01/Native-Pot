<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native Pot | Authentic Delicacies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfaf7; }
        .food-card:hover { transform: translateY(-10px); transition: 0.3s; }
        .cart-bounce { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        #admin-modal, #order-modal, #loading-overlay { background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); }
        button, footer, span, input { cursor: pointer !important; pointer-events: auto !important; position: relative; z-index: 20; }
        #admin-modal { z-index: 9999 !important; }
        .spinner { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #ea580c; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .checkmark { width: 56px; height: 56px; border-radius: 50%; display: block; stroke-width: 2; stroke: #fff; stroke-miterlimit: 10; box-shadow: inset 0px 0px 0px #7ac142; animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both; }
        .checkmark__circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 2; stroke-miterlimit: 10; stroke: #7ac142; fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark__check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 30px #7ac142; } }
    </style>
</head>
<body class="pb-32">

    <div id="loading-overlay" class="fixed inset-0 z-[10000] hidden flex flex-col items-center justify-center text-white text-center p-6">
        <div id="loader-content">
            <div class="spinner mx-auto mb-4"></div>
            <p class="font-bold animate-pulse text-lg">Cooking your new dish...</p>
        </div>
        <div id="success-content" class="hidden">
            <svg class="checkmark mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <p class="text-2xl font-bold">Dish Added!</p>
        </div>
    </div>

    <header class="p-6 bg-white shadow-sm sticky top-0 z-50">
        <nav class="max-w-5xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-orange-700 tracking-tighter">NATIVE POT</h1>
            <div id="cart-counter" class="bg-orange-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold shadow-lg">0</div>
        </nav>
    </header>

    <main id="menu-container" class="max-w-5xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-8"></main>

    <div id="checkout-bar" class="fixed bottom-8 left-4 right-4 max-w-md mx-auto bg-black rounded-3xl p-5 shadow-2xl flex justify-between items-center translate-y-40 transition-transform duration-500 z-[100]">
        <div>
            <button id="clear-pot-btn" class="text-gray-400 text-[10px] uppercase font-bold tracking-widest mb-1 underline block">Clear Pot</button>
            <p id="total-price" class="text-white text-xl font-bold">‚Ç¶0</p>
        </div>
        <button id="send-order-btn" class="bg-orange-600 text-white px-8 py-3 rounded-xl font-extrabold active:scale-95 transition">Send Order</button>
    </div>

    <div id="admin-modal" class="fixed inset-0 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 animate__animated animate__zoomIn my-auto">
            <h3 class="text-xl font-bold mb-4">Chef Management</h3>
            <div class="mb-6 border-b pb-6 text-left">
                <input type="text" id="food-name" placeholder="Dish Name" class="w-full p-4 mb-3 bg-gray-100 rounded-2xl outline-none">
                <input type="number" id="food-price" placeholder="Price (‚Ç¶)" class="w-full p-4 mb-3 bg-gray-100 rounded-2xl outline-none">
                <input type="file" id="photo-file" accept="image/*" class="mb-4 text-sm w-full">
                <button type="button" id="save-btn" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-bold">Save to Site</button>
            </div>
            <div id="delete-list" class="max-h-40 overflow-y-auto mb-4 text-left"></div>
            <button type="button" onclick="document.getElementById('admin-modal').classList.add('hidden')" class="w-full py-2 text-gray-400 font-bold text-center">Close Panel</button>
        </div>
    </div>

    <footer class="text-center py-12 text-gray-400 text-sm cursor-pointer relative z-[200]" onclick="document.getElementById('admin-modal').classList.remove('hidden')">
        <p>&copy; 2026 Native Pot. All rights reserved. ‚Ä¢ <span class="underline text-orange-600 font-bold">Admin Access</span></p>
    </footer>

    <script>
        const SUPABASE_URL = "https://rsyssgwehiosunegiqpk.supabase.co";
        const SUPABASE_KEY = "sb_publishable_b3sp-SMXTG7_cwIeY--t8g_4X-CjYb0";
        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/ddm87a9p2/image/upload";
        
        // Match your screenshot exactly (Case Sensitive)
        const CLOUDINARY_PRESET = "Native-pot"; 

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let pot = [];

        async function loadMenu() {
            const { data } = await supabase.from('menu').select('*').order('created_at', { ascending: false });
            const container = document.getElementById('menu-container');
            const deleteList = document.getElementById('delete-list');
            if (data) {
                container.innerHTML = data.map(item => `
                    <div class="food-card bg-white rounded-3xl overflow-hidden shadow-lg border border-orange-50">
                        <div class="h-48 bg-cover bg-center" style="background-image: url('${item.image}')"></div>
                        <div class="p-6">
                            <div class="flex justify-between items-center">
                                <h3 class="text-xl font-bold text-gray-800">${item.name}</h3>
                                <span class="text-orange-700 font-bold">‚Ç¶${Number(item.price).toLocaleString()}</span>
                            </div>
                            <button onclick="addToPot('${item.name}', ${item.price})" class="mt-6 w-full bg-orange-600 text-white py-3 rounded-2xl font-bold">Add to Pot</button>
                        </div>
                    </div>`).join('');
                deleteList.innerHTML = data.map(item => `
                    <div onclick="deleteItem('${item.id}')" class="flex justify-between items-center p-2 mb-2 bg-red-50 text-red-600 rounded-lg text-sm cursor-pointer">
                        <span>${item.name}</span><span>üóëÔ∏è</span>
                    </div>`).join('');
            }
        }

        function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = 800;
                        canvas.height = img.height * (800 / img.width);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        canvas.toBlob(b => resolve(b), 'image/jpeg', 0.7);
                    };
                };
            });
        }

        document.getElementById('save-btn').onclick = async function() {
            const file = document.getElementById('photo-file').files[0];
            const name = document.getElementById('food-name').value;
            const price = document.getElementById('food-price').value;
            if(!file || !name || !price) return alert("Fill all fields!");

            document.getElementById('loading-overlay').classList.remove('hidden');
            
            try {
                const compressed = await compressImage(file);
                const formData = new FormData();
                formData.append('file', compressed);
                formData.append('upload_preset', CLOUDINARY_PRESET);

                const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: formData });
                const imgData = await res.json();
                
                if (imgData.error) throw new Error(imgData.error.message);

                const { error } = await supabase.from('menu').insert([{ name, price, image: imgData.secure_url }]);
                if (error) throw error;

                document.getElementById('loader-content').classList.add('hidden');
                document.getElementById('success-content').classList.remove('hidden');
                setTimeout(() => location.reload(), 1500);
            } catch (err) {
                alert("Error: " + err.message);
                document.getElementById('loading-overlay').classList.add('hidden');
            }
        };

        async function deleteItem(id) {
            if(confirm("Remove?")) {
                await supabase.from('menu').delete().eq('id', id);
                location.reload();
            }
        }

        function addToPot(name, price) {
            pot.push({name, price});
            const total = pot.reduce((s, i) => s + i.price, 0);
            document.getElementById('cart-counter').innerText = pot.length;
            document.getElementById('total-price').innerText = `‚Ç¶${total.toLocaleString()}`;
            document.getElementById('checkout-bar').classList.remove('translate-y-40');
        }

        document.getElementById('send-order-btn').onclick = () => {
            const list = pot.map(i => `- ${i.name}`).join('\n');
            const total = pot.reduce((s, i) => s + i.price, 0);
            window.open(`https://wa.me/2349032797037?text=${encodeURIComponent("Order:\n"+list+"\nTotal: ‚Ç¶"+total)}`);
        };

        loadMenu();
    </script>
</body>
</html>
